<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}"></head>
<body>
	<nav th:replace="~{layout :: navbar}"></nav>

	<div class="content-wrapper">
		<div class="container">
			<!-- Encabezado -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<div>
					<h2 class="mb-0">
						<i class="bi bi-chat-quote-fill text-primary me-2"></i> Lista de
						Reviews
					</h2>
					<p class="text-muted mb-0">Gestión de reseñas y valoraciones</p>
				</div>
				<a href="/reviews/nuevo" class="btn btn-primary"> <i
					class="bi bi-plus-circle me-1"></i>Nueva Review
				</a>
			</div>

			<!-- Mensajes de alerta -->
			<div th:if="${mensaje}"
				th:class="'alert alert-' + ${tipo} + ' alert-dismissible fade show'"
				role="alert">
				<i
					th:class="'bi ' + (${tipo} == 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-triangle-fill') + ' me-2'"></i>
				<span th:text="${mensaje}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<!-- Estadísticas -->
			<div class="row mb-4">
				<div class="col-md-3">
					<div class="card bg-primary text-white">
						<div class="card-body">
							<h5 class="card-title">
								<i class="bi bi-chat-dots-fill me-2"></i>Total Reviews
							</h5>
							<h2 class="mb-0" th:text="${#lists.size(reviews)}">0</h2>
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="card bg-success text-white">
						<div class="card-body">
							<h5 class="card-title">
								<i class="bi bi-star-fill me-2"></i>5 Estrellas
							</h5>
							<h2 class="mb-0"
								th:text="${#lists.size(reviews.?[valoracion == 5])}">0</h2>
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="card bg-info text-white">
						<div class="card-body">
							<h5 class="card-title">
								<i class="bi bi-star-fill me-2"></i>4 Estrellas
							</h5>
							<h2 class="mb-0"
								th:text="${#lists.size(reviews.?[valoracion == 4])}">0</h2>
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="card bg-warning text-white">
						<div class="card-body">
							<h5 class="card-title">
								<i class="bi bi-star-half me-2"></i>≤ 3 Estrellas
							</h5>
							<h2 class="mb-0"
								th:text="${#lists.size(reviews.?[valoracion <= 3])}">0</h2>
						</div>
					</div>
				</div>
			</div>

			<!-- Grid de reviews (tipo tarjetas) -->
			<div th:if="${#lists.isEmpty(reviews)}" class="text-center py-5">
				<i class="bi bi-inbox fs-1 text-muted d-block mb-3"></i>
				<h4 class="text-muted">No hay reviews registradas</h4>
				<a href="/reviews/nuevo" class="btn btn-primary mt-3"> <i
					class="bi bi-plus-circle me-1"></i>Crear primera review
				</a>
			</div>

			<div class="row row-cols-1 row-cols-md-2 g-4">
				<div class="col" th:each="review : ${reviews}">
					<div class="card h-100">
						<div class="card-body">
							<div
								class="d-flex justify-content-between align-items-start mb-3">
								<div>
									<h5 class="card-title mb-1">
										<i class="bi bi-person-circle text-primary me-1"></i> <span
											th:text="${review.cliente.nombre}">Cliente</span>
									</h5>
									<small class="text-muted">ID: <span
										th:text="${review.id}">1</span></small>
								</div>
								<div>
									<!-- Estrellas de valoración -->
									<div class="stars">
										<span th:each="i : ${#numbers.sequence(1, 5)}"> <i
											th:class="${i <= review.valoracion ? 'bi bi-star-fill text-warning' : 'bi bi-star text-muted'}"></i>
										</span>
									</div>
									<small class="text-muted d-block text-end"> <span
										th:text="${review.valoracion}">5</span>/5
									</small>
								</div>
							</div>

							<p class="card-text" th:text="${review.descripcion}">
								Descripción de la review</p>

							<div class="d-flex justify-content-between align-items-center">
								<div>
									<span class="badge"
										th:classappend="${review.valoracion >= 4 ? 'bg-success' : (review.valoracion == 3 ? 'bg-warning' : 'bg-danger')}">
										<span th:if="${review.valoracion >= 4}">Positiva</span> <span
										th:if="${review.valoracion == 3}">Neutral</span> <span
										th:if="${review.valoracion < 3}">Negativa</span>
									</span>
								</div>
								<div class="btn-group" role="group">
									<a th:href="@{/reviews/editar/{id}(id=${review.id})}"
										class="btn btn-sm btn-warning" title="Editar"> <i
										class="bi bi-pencil-fill"></i>
									</a> <a th:href="@{/reviews/eliminar/{id}(id=${review.id})}"
										class="btn btn-sm btn-danger"
										onclick="return confirm('¿Está seguro de eliminar esta review?')"
										title="Eliminar"> <i class="bi bi-trash-fill"></i>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<footer th:replace="~{layout :: footer}"></footer>
	<div th:replace="~{layout :: scripts}"></div>
</body>
</html>
