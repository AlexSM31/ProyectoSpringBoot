<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}"></head>
<body>
	<nav th:replace="~{layout :: navbar}"></nav>

	<div class="content-wrapper">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-8">
					<!-- Encabezado -->
					<div class="mb-4">
						<h2>
							<i class="bi bi-chat-quote-fill text-primary me-2"></i> <span
								th:text="${accion == 'nuevo' ? 'Nueva Review' : 'Editar Review'}">Formulario
								Review</span>
						</h2>
						<p class="text-muted">Complete los datos de la review</p>
					</div>

					<!-- Formulario -->
					<div class="card">
						<div class="card-body">
							<form th:action="@{/reviews/guardar}" th:object="${review}"
								method="post">
								<!-- ID oculto para edición -->
								<input type="hidden" th:field="*{id}" />

								<!-- Seleccionar Cliente -->
								<div class="mb-3">
									<label for="clienteId" class="form-label"> <i
										class="bi bi-person-fill text-primary"></i> Cliente *
									</label> <select class="form-select" id="clienteId" name="clienteId"
										required>
										<option value="">Seleccione un cliente...</option>
										<option th:each="cliente : ${clientes}"
											th:value="${cliente.id}" th:text="${cliente.nombre}"
											th:selected="${review.cliente != null && review.cliente.id == cliente.id}">
											Cliente</option>
									</select> <small class="form-text text-muted"> Seleccione el
										cliente que realizó la review </small>
								</div>

								<!-- Valoración (Estrellas) -->
								<div class="mb-3">
									<label class="form-label"> <i
										class="bi bi-star-fill text-warning"></i> Valoración *
									</label>
									<div class="btn-group w-100" role="group">
										<input type="radio" class="btn-check" name="valoracion"
											id="star1" th:field="*{valoracion}" value="1" required>
										<label class="btn btn-outline-warning" for="star1"> <i
											class="bi bi-star-fill"></i> 1
										</label> <input type="radio" class="btn-check" name="valoracion"
											id="star2" th:field="*{valoracion}" value="2"> <label
											class="btn btn-outline-warning" for="star2"> <i
											class="bi bi-star-fill"></i> 2
										</label> <input type="radio" class="btn-check" name="valoracion"
											id="star3" th:field="*{valoracion}" value="3"> <label
											class="btn btn-outline-warning" for="star3"> <i
											class="bi bi-star-fill"></i> 3
										</label> <input type="radio" class="btn-check" name="valoracion"
											id="star4" th:field="*{valoracion}" value="4"> <label
											class="btn btn-outline-warning" for="star4"> <i
											class="bi bi-star-fill"></i> 4
										</label> <input type="radio" class="btn-check" name="valoracion"
											id="star5" th:field="*{valoracion}" value="5"> <label
											class="btn btn-outline-warning" for="star5"> <i
											class="bi bi-star-fill"></i> 5
										</label>
									</div>
									<small class="form-text text-muted"> Seleccione una
										valoración de 1 a 5 estrellas </small>
								</div>

								<!-- Descripción -->
								<div class="mb-4">
									<label for="descripcion" class="form-label"> <i
										class="bi bi-file-text text-primary"></i> Descripción *
									</label>
									<textarea class="form-control" id="descripcion"
										th:field="*{descripcion}" rows="5" required maxlength="1000"
										placeholder="Escriba aquí su opinión y experiencia..."></textarea>
									<small class="form-text text-muted"> Máximo 1000
										caracteres. <span id="contador">0</span>/1000
									</small>
								</div>

								<!-- Botones -->
								<div class="d-grid gap-2 d-md-flex justify-content-md-end">
									<a href="/reviews" class="btn btn-secondary"> <i
										class="bi bi-x-circle me-1"></i>Cancelar
									</a>
									<button type="submit" class="btn btn-primary">
										<i class="bi bi-check-circle-fill me-1"></i>Guardar
									</button>
								</div>
							</form>
						</div>
					</div>

					<!-- Información adicional -->
					<div class="alert alert-info mt-3">
						<i class="bi bi-info-circle-fill me-2"></i> <strong>Nota:</strong>
						Los campos marcados con (*) son obligatorios.
					</div>
				</div>
			</div>
		</div>
	</div>

	<footer th:replace="~{layout :: footer}"></footer>
	<div th:replace="~{layout :: scripts}"></div>

	<script>
        // Contador de caracteres para la descripción
        document.addEventListener('DOMContentLoaded', function() {
            const descripcion = document.getElementById('descripcion');
            const contador = document.getElementById('contador');
            
            function actualizarContador() {
                contador.textContent = descripcion.value.length;
            }
            
            descripcion.addEventListener('input', actualizarContador);
            actualizarContador();
        });
    </script>
</body>
</html>
